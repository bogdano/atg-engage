<!DOCTYPE html>
{% extends 'base.html' %}
{% load static %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leaderboard</title>
    <!-- Ensure your static path to CSS is correct -->
    <link href="{% static 'css/tailwind.min.css' %}" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org" defer></script>
    <!-- Add later if time
    <style>
        /* Dynamically set the background color if a leaderboard is selected */
        {% if selected_leaderboard_color %}
        body { background-color: {{ selected_leaderboard_color }}; }
        {% endif %}
    </style>    -->
</head>
<!--<body class="{% if selected_leaderboard_color %}custom-bg-color{% endif %} bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center mb-8">Leaderboard</h1>

        {% if selected_leaderboard_logo %}
        <div class="text-center mb-4">
            <img src="{{ selected_leaderboard_logo }}" alt="Leaderboard Logo" class="mx-auto">
        </div>
        {% endif %}

        {% if selected_leaderboard_id %}
        <div class="text-center mb-4">
            <a href="{% url 'edit_leaderboard_detail' selected_leaderboard_id %}" class="px-4 py-2 bg-blue-500 hover:bg-blue-700 text-white font-bold rounded-lg">Edit Leaderboard</a>
        </div>
        {% endif %}
        <a href="{% url 'list_teams' %}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">View Joinable Teams</a>

    </div>
</body>-->
{% block content %}
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- Dynamic Title -->
        <h1 class="text-4xl font-bold text-center mb-8">
            {% if request.GET.leaderboard_id %}
                {% for leaderboard in leaderboards %}
                    {% if leaderboard.id|stringformat:"s" == request.GET.leaderboard_id %}
                        {{ leaderboard.leaderboard_name }} Leaderboard
                    {% endif %}
                {% endfor %}
            {% else %}
                All Activities Leaderboard
            {% endif %}
        </h1>

        <!-- Joinable Teams Button -->
        <div class="text-center mb-4">
            <a href="{% url 'list_teams' %}" class="inline-block bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">View Joinable Teams</a>
        </div>

        <!-- Filtering Form -->
        <form action="{% url 'individual_leaderboard' %}" method="get" class="flex justify-center gap-4 mb-4">
            <!-- Leaderboard Type Filter -->
            <select name="leaderboard_id" class="border-2 border-gray-300 rounded-lg p-4 w-1/3" onchange="this.form.submit();">
                <option value="" {% if not request.GET.leaderboard_id %}selected{% endif %}>All Activities</option>
                {% for leaderboard in leaderboards %}
                <option value="{{ leaderboard.id }}" {% if request.GET.leaderboard_id == leaderboard.id|stringformat:"s" %}selected{% endif %}>
                    {{ leaderboard.leaderboard_name }}
                </option>
                {% endfor %}
            </select>
        
            <!-- Date Filter -->
            <select name="date_filter" class="border-2 border-gray-300 rounded-lg p-4 w-1/3" onchange="this.form.submit();">
                <option value="all_time" {% if request.GET.date_filter == "all_time" %}selected{% endif %}>All Time</option>
                <option value="this_year" {% if request.GET.date_filter == "this_year" %}selected{% endif %}>This Year</option>
                <option value="this_month" {% if request.GET.date_filter == "this_month" or not request.GET.date_filter %}selected{% endif %}>This Month</option>
            </select>
        </form>

        <!-- Toggle Buttons for Team and Individual Leaderboards -->
        <div class="flex justify-center gap-4 mb-6">
            <button hx-get="{% url 'individual_leaderboard' %}?leaderboard_id={{ request.GET.leaderboard_id }}&date_filter={{ request.GET.date_filter|default:'this_month' }}"
                    hx-target="#leaderboard" hx-trigger="click" class="px-6 py-2 bg-blue-500 hover:bg-blue-700 text-white font-bold rounded-lg">
                Individual
            </button>
            <button hx-get="{% url 'team_leaderboard' %}?leaderboard_id={{ request.GET.leaderboard_id }}&date_filter={{ request.GET.date_filter|default:'this_month' }}"
                    hx-target="#leaderboard" hx-trigger="click" class="px-6 py-2 bg-green-500 hover:bg-green-700 text-white font-bold rounded-lg">
                Team
            </button>
        </div>
        
        <!-- Leaderboard Content -->
        <div id="leaderboard" class="mt-8">
            <!-- This will be filled dynamically with HTMX or initial content if needed -->
            {% include 'partials/individual_leaderboard.html' %}
        </div>
    </div>
    <script>
        document.body.addEventListener('htmx:configRequest', function(event) {
            console.log('HTMX Request:', event.detail);
        });
    </script>
</body>
{% endblock %}